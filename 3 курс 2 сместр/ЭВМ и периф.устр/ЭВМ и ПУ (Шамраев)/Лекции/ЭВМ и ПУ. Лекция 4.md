#### 12.03.2020

Адрес занимает 1 байт.

USART - универсальный синхронный, асинхронный 

##### Особенности реализации UART в msp430.

Поддерживаются 7 и 8 битные данные с проверкой на четность / нечетность или без проверки.

Независимые сдвиговые и буферные регистры приема и передачи.

Данные передаются МЛАДШИМИ битами вперед.

Поддерживаются многопроцессорные коммуникационные протоколы со свободной линией и адресным битом.

Аппаратно реализовано детектирование стартового фронта для автоматического выхода из режимов пониженного энергопотребления.

Программируемая скорость проема-передачи, детектирование ошибок и независимые векторы прерываний для приема и передач. 

Процедура инициализации модуля должна начинаться с флага SWRST, далее выполняется конфигурация модуля путем установки требуемых битов в регистре UxCTL. Включение модуля осуществляется установкой бита MEx, после чего необходимо сбросить флаг SWRST. 

Формат символа:

<img src="C:\Users\vm\AppData\Roaming\Typora\typora-user-images\image-20200312085318135.png" alt="image-20200312085318135" style="zoom:80%;" />

Информация считывается трижды в середине каждого битового интервала и данные принимаются по "какому-то" принципу 2 из 3.

Многопроцессорный формат со свободной линией.

Линия считается свободной после обнаружения периода простоя длительностью 10 и более битовых интервалов высокого уровня. 1-й байт передаваемый после периода простоя воспринимается всеми устройствами как адрес.

Альтернативой этому протоколу является протокол с адресным битом.

##### Многопроцессорный формат с адресным битом. 

каждый передаваемый символ содержит дополнительный бит, который определяет тип передаваемой информации. Если AD = 1 - передается адрес, если AD = 0 - передаются данные.

Если длина сообщения > 10 бит, есть смысл выбрать протокол со свободной линией. 

Контроллер скорости передачи обеспечивает формирование стандартных скоростей обмена от источников нестандартных частот. 

fACLK = 32768Гц.

fSMCLK = 8мГц.

f (скорость) =  BRCLK / BR

OMCTL - регистр модулятора

BR = [1BRCLK / speed]

##### Прерывания

Пример: нажатие на клавишу вызывает прерывание, выполняется действие связанное с этой клавишей, затем продолжаются действия выполняемые ранее процессором.

Маскируемые прерывания могут быть разрешены или запрещены программно.

Ножки портов P1, P2, обладают возможностью формирования сигналов запросов прерываний. Выбор и управление режимами прерываний от Р1, Р2, управляют 3 дополнительных регистра: PnIE, установка бита в этом регистре разрешает  прерывание от соответствующей ножке порта. PnIFG - это регистр флагов запроса прерываний. 1 в разрядах этого регистра говорит о том, что на соответствующей ножке порта распознан сигнал запроса прерываний (1 - есть запрос прерываний,  0 - нет).

Все линии порта Р1 являются источниками одного вектора прерывания, а линии порта Р2 - другого. Для определения, какая линия запросила прерывания в обработчике необходимо опросить регистр PnIFG и перед выходом из обработчика сбросить соответствующие разряды PnIFG. 

Регистр выбора запроса прерывания PnIES - регистр выбора фронта запроса прерываний.

0 - передний фронт, 1 - задний фронт.

<img src="C:\Users\vm\AppData\Roaming\Typora\typora-user-images\image-20200314083553202.png" alt="image-20200314083553202" style="zoom:50%;" />

P2IES & =~ BIIO; - Сброс. Запрос прерываний по переднему фронту.                                                                                                            ...                 OXFE;

P2IES | = BIIO; - Разрешение прерываний.

Если кнопка не нажата на входах будут единицы.

Выставили 0 на Р4, опросили строки, Выставили 0 на Р5 ....

Микросхема PCA9538 представляет собой регистр расширения порта управляемый по протоколу I2C, конфигурирование осуществляется доcтупом к 4-м внутренним регистрам управления:

input port - адрес 0х00

output port - адрес 0х01

polaryty Inversion - регистр управления полярности, адрес 0х02 - 

configuration - регистр выбора направления, адрес 0х03 (задает направление работы ножки порта 1 - работает на вход, 0 - на выход).



