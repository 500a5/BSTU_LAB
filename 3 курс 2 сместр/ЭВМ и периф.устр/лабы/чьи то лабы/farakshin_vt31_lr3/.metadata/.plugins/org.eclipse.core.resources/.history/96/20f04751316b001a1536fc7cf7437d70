#include <msp430.h> 
#include "system_define.h"
#include "system_variable.h"
#include "function_prototype.h"
#include "I2C.h"
#include "main.h"

/*
 * main.c
 */

void Disable_Watchdog(){
    WDTCTL = WDTPW+WDTHOLD; // Disable watchdog timer
}


// Разработать программу, фиксирующую нажатия клавиш 5, 7 и 9 матричной
// клавиатуры  включением  светодиодов  5,  6  и  7  соответственно.  Выход  из
// цикла  опроса  осуществляется  при  нажатии  клавиши  *.  Частота  тактовых
// импульсов на линии SCL – 20 кГц.

void main(void) {
    int speed = 100;
    Disable_Watchdog();
    Init_System_Clock();
    Init_System();
    // общее включение прерываний
    _enable_interrupt();
    //Init_I2C();
    Init_I2C_custom_speed();
    // Зачем-то же эта функция есть? надо использовать
    LED_fx3(speed);
    wait_1mks(5);
    // Теперь сканируем клавиатуру... Если получаем 5, 7, 9 - отправляем сигнал
    LED_clear();
    char key = 0;
    int stop_it = 0;
    while ((key = KEYS_waitkey()) != '*' && !stop_it){
        switch (key)
        {
        case '5':
            LED_clear();
            LED_set(5);
            break;
        case '7':
            LED_clear();
            LED_set(6);
            break;
        case '9':
            LED_clear();
            LED_set(7);
            break;
        case '*':
            // Время закругляться
            stop_it = 1;
        default:
            break;
        }
    }
    while(1){
        LED_fx1(speed);
        wait_1mks(5);
        LED_fx2(speed);
        wait_1mks(5);
        LED_fx3(speed);
        wait_1mks(5);
    }
}
